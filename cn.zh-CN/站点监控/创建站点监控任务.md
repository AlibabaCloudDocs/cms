# 创建站点监控任务

您可以通过创建站点监控任务，对互联网进行网络探测，进而实现网络质量分析和性能分析。

-   如果您需要在创建站点监控任务的同时设置报警规则，则建议您先创建报警联系人和报警联系组，以便在设置报警规则时选择相应的报警联系组，用于接收报警通知，操作方法请参见[创建报警联系人或报警联系组](/cn.zh-CN/报警服务/报警联系人/创建报警联系人或报警联系组.md)。
-   如果您需要在设置报警规则时使用报警回调功能，则请准备通过公网访问的回调URL，并在已有的运维系统或消息通知系统的告警方式中开启URL回调。

站点监控主要用于通过遍布全国的互联网终端节点，发送模拟真实用户访问的探测请求，监控全国各省市运营商网络终端用户到您服务站点的访问情况。以下是站点监控的典型应用场景。

-   通过站点监控的探测点，模拟最终用户的访问行为，获得全国各地到目标地址的访问数据，从而得知各地域和各运营商的网络质量，可针对性的进行网络优化。
-   通过创建站点监控任务，可以获得访问目标地址的DNS域名解析时间、连接时间、首包时间、下载时间等，从而分析服务的性能瓶颈。
-   通过添加阿里巴巴和运营商的服务站点，选择目标探测点，针对探测结果，得出阿里巴巴和运营商的质量分析。
-   站点监控支持从阿里云各地域的机房或全国各地终端节点发起探测请求。

## 操作步骤

1.  登录[云监控控制台](https://cloudmonitor.console.aliyun.com)。

2.  在左侧导航栏，选择**站点监控** \> **站点管理**。

3.  在站点管理页面，单击**新建监控任务**。

4.  设置基本信息。

    |参数|描述|
    |--|--|
    |**监控类型**|支持监控协议HTTP（S）、PING、TCP、UDP、DNS、SMTP、POP3和FTP。|
    |**IP探针类型**|支持IP探针类型IPv4和IPv6。|
    |**任务名称**|监控任务名称。取值：4~100个字符，支持英文字母、数字、下划线（\_）和汉字。|
    |**监控地址**|目标监控地址。一次可以填写多个监控地址，多个监控地址之间用回车键换行分隔。保存时会将多个监控地址拆分为多个任务。|
    |**监控频率**|监控周期。取值：1分钟、5分钟、15分钟、30分钟和60分钟。例如：选择1分钟频率，各地域探测点将以1分钟/次的频率监控目标地址。|
    |**高级设置**|不同协议支持不同的高级设置，请根据实际情况选择使用，请参见[说明信息](#section_08r_0oc_dac)。|

5.  选择探测点。

    -   **快捷选择探测点**：将常用探测点打包，方便您批量快速选择。
    -   **探测点高级选项**：按运营商和地域选择探测点。
6.  设置报警规则。

    |参数|描述|
    |--|--|
    |**可用性**|探测点的可用性。取值：    -   可用探测点数量

可用探测点数量等于一个周期内探测点的状态码小于400的探测结果数量。

    -   可用探测点百分比

可用探测点百分比=一个周期内（探测点的状态码小于400的探测结果数量/探测结果总数量）\*100。

    -   任意状态码（独立报警）
    -   所有状态码（组合报警） |
    |**平均响应时间**|每个监控周期内所有探测点的响应时间的平均值。|
    |**连续几次超过阈值后报警**|实际监控值连续几次达到设置的阈值才会报警。该参数用来过滤监控数据偶尔发生波动的情况。|
    |**联系人通知组**|接收报警通知的对象。|
    |**报警级别**|报警通知的发送渠道。|
    |**通道沉默时间**|报警发生后如果未恢复正常，间隔多久重复发送一次报警通知。|
    |**生效时间**|报警规则的生效时间。报警规则只在生效时间内发送报警通知，非生效时间内产生的报警只记录报警历史。|
    |**报警回调**|填写公网可访问的URL。云监控会将报警信息通过POST请求推送到该地址，目前仅支持HTTP协议。|

7.  单击**创建**。


## 说明信息

监控类型的高级设置如下表所示。

-   HTTP（S）

    |选项|输入方式|是否必选|描述|
    |--|----|----|--|
    |监控地址|URL|是|    -   如果URL中有schema部分，则为HTTPS，例如：`https:/aliyun.com`。
    -   如果URL中无schema部分，则默认值为HTTP。 |
    |请求内容|表单数据或JSON对象|否|如果是JSON格式，则仅支持JSON对象，即以大括号\(\{\}\)括起来的数据，否则系统将会当作表单数据处理。|
    |请求方法|单选|是|支持三种HTTP方法：

    -   GET
    -   POST
    -   HEAD
默认值：GET。 |
    |匹配响应方式|单选|是|当匹配响应内容非空时，站点监控读取HTTP服务器回应Body的前64K字节，从中查找匹配响应内容，有两种结果：

    -   包含匹配相应内容
    -   不包含匹配相应内容
站点监控会根据匹配响应方式来决定是否报警。

阿里巴巴探测点支持中文和英文，运营商探测点仅支持英文。如果您的任务同时选择了两种探测点，为避免探测结果不支持，强烈建议在匹配响应内容中仅使用英文。 |
    |匹配响应内容|文本|否|
    |HTTP请求头|多行文本|否|每行的格式与HTTP Header的格式相同，都是以英文冒号（:）分隔的KV结构。站点监控会在请求头中预置以下Header：

    -   `Host:${监控地址中的域名}`
    -   `Pragma:no-cache`
    -   `Cache-Control:no-cache`
    -   `User-Agent:Chrome/57`
    -   `Accept: */*`
当请求内容是表单时，还会有以下Header：

`Content-Type: application/x-www-form-urlencoded;charset=UTF-8`

如果您的Header中出现了以上内容的某一项或某几项，则这几项将被您的设置所覆盖。

**说明：** 根据HTTP协议，您提供的请求头中的key会被站点监控转换为canonical format of MIME Header形式：

    -   首字母以及短划线（-）后面的字母被转换为大写形式。如accept-encoding被转换为Accept-Encoding。
    -   如果key中包含空格或其他非法字符，则key保持不变。 |
    |Cookie|Cookie文本|否|HTTP规则的Cookie文本。|
    |HTTP验证用户名|用户名|否|通过HTTP协议的基础验证。|
    |HTTP验证密码|密码|否|
    |证书验证|勾选|否|是否支持SNI。默认不勾选，即不支持。|
    |不跟随跳转|勾选|否|如果出现301或302状态码，是否跟随再次做重定向探测。默认不勾选，即跟随跳转。|

-   PING

    |选项|输入方式|是否必选|描述|
    |--|----|----|--|
    |监控地址|域名或IP地址|是|无|
    |ping包数目|正整数|是|发起ping的次数。默认值：20， 取值范围：1~40。|

-   TCP或UDP

    |选项|输入方式|是否必选|描述|
    |--|----|----|--|
    |监控地址|域名或IP地址|是|-|
    |请求内容的格式|单选|是|请求内容非空时有效。取值：    -   文本
    -   十六进制格式 |
    |请求内容|普通文本或十六进制格式|否|    -   普通文本

普通文本指字符串，即由可见字符组成的字符串。

**说明：** 普通文本不支持转义，即不会将\\n转为回车符，只是当做两个字符：\\和n。

    -   十六进制格式

当请求的内容是Byte串，无法用可见字符表达时，可以将Byte串转换为十六进制表示的可见字符串形式。具体转换规则为：一个Byte转换成二字节的十六进制字符，例如：`(byte)1`转换成十六进制为01， `(byte)27`转换成十六进制为1B。

二进制数组（Java形式）：`{(byte)1, (byte)27}`转换成十六进制为：011b或011B。站点监控对十六进制不区分大小写。将字符串`"011B"`填入请求内容中，同时请求内容格式选择十六进制格式。 |
    |响应内容的格式|单选|是|响应内容非空时有效。包括十六进制格式或文本。|
    |响应内容|普通文本或十六进制格式|否|    -   普通文本

普通文本指字符串，即由可见字符组成的字符串。

**说明：** 普通文本不支持转义，即不会将\\n转为回车符，只是当做两个字符：\\和n。

    -   十六进制格式

当请求的内容是Byte串，无法用可见字符表达时，可以将Byte串转换为十六进制表示的可见字符串形式。具体转换规则为：一个Byte转换成二字节的十六进制字符，例如：`(byte)1`转换成十六进制为01， `(byte)27`转换成十六进制为1B。

二进制数组（Java形式）：`{(byte)1, (byte)27}`转换成十六进制为：011b或011B。站点监控对十六进制不区分大小写。将字符串`"011B"`填入请求内容中，同时请求内容格式选择十六进制格式。 |

-   DNS

    |高级选项|输入方式|是否必选|描述|
    |----|----|----|--|
    |监控域名|域名|是|无|
    |DNS查询类型|单选|是|支持六种：A、MX、NS、CNAME、TXT、ANY。

默认值：A。 |
    |DNS服务器|服务器IP地址|否|如果为空，则使用探针默认DNS服务器地址。可以是域名或IP地址。|
    |期望解析别名或IP地址|多行文本|否|每行代表一个IP地址或者一个域名。

当期望列表是DNS列表的子集时，才认为探测成功。 |

-   POP3

    |高级选项|输入方式|是否必选|描述|
    |----|----|----|--|
    |监控地址|URL|是|    -   如果URL中有schema，则为POP3（S），例如pop3s://pop3.aliyun.com。
    -   如果URL中无schema，则为POP3。
**说明：** POP3（S）使用TLS进行加密传输。 |
    |用户名|文本|是|使用用户名和密码命令进行认证。

请谨慎输入用户名密码，站点监控会按您设置的频率进行探测，如果用户名密码错误，过于频繁的探测可能会导致对方服务屏蔽您的账号。 |
    |密码|文本|是|

-   SMTP

    |高级选项|输入方式|是否必选|描述|
    |----|----|----|--|
    |监控地址|URL|是|    -   如果URL中有schema，则为SMTP（S），例如smtps://smtp.aliyun.com。
    -   如果URL中无schema，则为SMTP。
**说明：** SMTP（S）通过start tls命令与服务器进行协商加密，使用安全连接时，认证也是通过加密进行的。 |
    |用户名|文本|是|使用Plain进行认证。

请谨慎输入用户名密码，站点监控会按您设置的频率进行探测，如果用户名密码错误，过于频繁的探测可能会导致对方服务屏蔽您的账号。 |
    |密码|文本|是|

-   FTP

    |高级选项|输入方式|是否必选|描述|
    |----|----|----|--|
    |监控地址|URL|是|例如：ftp://smtp.aliyun.com。|
    |是否匿名登录|单选|是|    -   匿名登录（默认值）
    -   需要身份验证

当您选择该参数时，需要设置FTP服务器的用户名和密码。 |
    |用户名|文本|是|FTP服务器的用户名和密码。 |
    |密码|文本|是|


