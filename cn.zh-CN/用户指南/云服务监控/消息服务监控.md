# 消息服务监控 {#concept_qyg_ysp_ydb .concept}

云监控通过监控Message Service的延迟消息、无效消息、活跃消息等监控项，帮助您获取Message Service队列的使用情况。在您创建Message Service的消息队列后，云监控自动开始对其进行监控，您还可以对监控项设置报警规则，以便数据异常时收到报警信息。

## 监控服务 {#section_gly_ltp_ydb .section}

-   **监控项说明**

    |监控项|含义|维度|单位|最小监控粒度|
    |:--|:-|:-|:-|:-----|
    |ActiveMessages|在该Queue中处于Active状态的消息总数|userId,region,bid,queue|个|5分钟|
    |InactiveMessages|在该Queue中处于Inactive状态的消息总数|userId,region,bid,queue|个|5分钟|
    |DelayMessage|在该Queue中处于Delayed状态的消息总数|userId,region,bid,queue|个|5分钟|
    |SendMessageCount|发送消息请求量|userId,region,queue|个|60分钟|
    |BatchSendMessageCount|批量发送消息请求量|userId,region,queue|个|60分钟|
    |ReceiveMessageCount|接收消息请求量|userId,region,queue|个|60分钟|
    |BatchReceiveMessageCount|批量接收消息请求量|userId,region,queue|个|60分钟|
    |BatchDeleteMessageCount|批量删除消息请求量|userId,region,queue|个|60分钟|
    |ChangeMessageVisibilityCount|更改消息可见性计数|userId,region,queue|个|60分钟|


-   **查看监控数据**
    1.  登录[云监控控制台](https://cms-intl.console.aliyun.com)。
    2.  单击左侧导航栏中**云服务监控**下的**消息服务**，进入消息服务监控列表页面。
    3.  单击队列名称或**操作**中的**监控图表**，进入监控图表页面。
    4.  （可选）单击大小图切换按钮，切换大图显示。

## 报警服务 {#section_akp_dvp_ydb .section}

-   **设置报警规则**
    1.  登录[云监控控制台](https://cms-intl.console.aliyun.com)。
    2.  单击左侧导航栏中**云服务监控**下的**消息服务**，进入消息服务监控列表页面。
    3.  单击实例列表**操作**中的**报警规则**，进入实例的报警规则页面。
    4.  单击右上角的**创建报警规则**，选择资源范围、根据参数设置报警规则，选择通知方式，单击**确认**即可。
-   **参数说明**
    -   产品：例如云服务器ECS、RDS、OSS 等。
    -   资源范围：报警规则的作用范围，分为全部资源、queue维度。
        -   全部资源：表示该规则作用在用户名下对应产品的全部实例上。例如设置了全部资源粒度的MongoDB CPU使用率大于80%报警，则只要用户名下有MongoDB CPU使用率大于80%，就会发送报警通知。资源范围选择全部资源时，报警的资源最多1000个，超过1000个可能会导致达到阈值不报警的问题，建议您使用应用分组按业务划分资源后再设置报警。
        -   queue维度：表示该规则只作用在某个具体消息队列上。
    -   规则名称：报警规则的名称。
    -   规则描述：报警规则的主体，定义在监控数据满足何种条件时，触发报警规则。例如规则描述为延迟消息5分钟平均值\>=10个，则报警服务会5分钟检查一次5分钟内的数据是否满足平均值\>=10个。

        **报警规则举例说明**：以主机监控为例，单个服务器监控指标15秒上报一个数据点，5分钟有20个数据点。

        -   CPU使用率5分钟平均值\>90%， 含义是CPU使用率 5分钟的20个数据点平均值大于90%。
        -   CPU使用率5分钟总是\>90%， 含义是CPU使用率 5分钟的20个数据点全部大于90%。
        -   CPU使用率5分钟只要有一次\>90%，含义是CPU使用率 5分钟的20个数据点至少有1个大于90%。
        -   公网流出流量5分钟总计\>50M ，含义是公网流出流量5分钟的20个数据点求和结果大于50M。
    -   通道沉默时间：指报警发生后如果未恢复正常，间隔多久重复发送一次报警通知。
    -   连续几次超过阈值后报警：连续几次报警的探测结果符合您设置的规则描述，才会触发报警。例如规则描述为“CPU使用率 1分钟内平均值\>80%,连续3次超过阈值后报警”，则连续出现3次 CPU使用率 1分钟内平均值\>80%的情况，才会触发报警。
    -   生效时间：报警规则的生效时间，报警规则只在生效时间内才会检查监控数据是否需要报警。
    -   通知对象：发送报警的联系人组。
    -   报警级别：
        -   邮件+钉钉机器人
    -   邮件主题：默认为产品名称+监控项名称+实例ID。
    -   邮件备注：自定义报警邮件补充信息。填写邮件备注后，发送报警的邮件通知中会附带您的备注。
    -   报警回调：填写公网可访问的URL，云监控会将报警信息通过POST请求推送到该地址，目前仅支持HTTP协议。

